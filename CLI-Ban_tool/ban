#!/bin/bash
### Add hashkey to banlist in a running PR console ###
# Execute script name and enter the hash of someone
# as an argument to be added to the banlist.
# I recommend to put the script in ~/bin and add 
# ~/bin to $PATH
# Usage: ./ban.sh <hash>
#
### Written by tobi-the-fraggel and Cisco ###


#####################################################################
### Server Variables / Edit to your needs! #########################
#
# Absolute path to scheduled bans file. Call it banlist.txt?
TEMPBAN="/path/to/your/banlist.txt"
#
# Absolute path to your banlist.con
BANLIST="/path/to/your/server/mods/pr/settings/banlist.con"
# Name of screen session your PR server is running in
SCREEN="NameOfYourScreenSession"
#
#####################################################################

#####################################################################
#Constants (Do not edit if you don't know what you are doing)
TIME="perm"
HASH=$1
LENGTH=$(echo $1 | wc -m)
DAYSTOBAN=$2
BANTIME=$(date -I -d "+$2 days")
#####################################################################


# Do some tests.
if [ -n "$2" ]
	then
		echo "$BANTIME $HASH" >> "$TEMPBAN"
fi

if [ $LENGTH -ne 33 ]
    then
        echo "Usage: ban <hash>"
		echo "Length of hash is not correct. Did you copy the entire hash? Exiting script."
        exit 1
	else
		echo "Hash is correct."
fi

if grep -q "$1" "BANLIST"
	then
		echo "Hash is already added to banlist. Exiting script."
		exit 1
fi


#Send command to screen session
echo "Adding $1 to banlist..."
screen -x "$SCREEN" -X stuff "admin.addKeyToBanList $1 $TIME"$(echo -ne '\015')
echo "Git good motherfucker."